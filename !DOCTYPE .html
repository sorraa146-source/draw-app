<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Advanced Online Draw App</title>
<style>
:root {
  --bg:#121212;--panel:#1e1e1e;--panel2:#262626;--accent:#4da3ff;--text:#f2f2f2;--muted:#9a9a9a;--border:#333;
}
*{box-sizing:border-box;font-family:system-ui,Segoe UI,sans-serif}
body{margin:0;background:var(--bg);color:var(--text);display:grid;grid-template-columns:260px 1fr;grid-template-rows:auto 1fr; height:100vh}
header{grid-column:1/3;padding:12px 16px;background:#1a1a1a;border-bottom:1px solid var(--border);font-weight:600}
aside{background:var(--panel);border-right:1px solid var(--border);padding:12px;overflow:auto}
main{display:flex;align-items:center;justify-content:center;background:#0d0d0d}
canvas{background:#fff;border-radius:4px;box-shadow:0 10px 40px rgba(0,0,0,.7)}
h3{font-size:12px;color:var(--muted);margin:14px 0 6px;text-transform:uppercase}
button{width:100%;padding:8px;margin-bottom:6px;border-radius:6px;border:1px solid var(--border);background:#2b2b2b;color:var(--text);cursor:pointer}
button:hover{background:#353535}
button.active{background:var(--accent);color:#000;border:none}
input,select{width:100%;margin-bottom:6px}
.row{display:flex;flex-wrap:wrap;gap:6px}
.swatch{width:22px;height:22px;border-radius:4px;border:1px solid #000;cursor:pointer}
.swatch.active{outline:2px solid white}
#onlinePanel{display:none;background:var(--panel2);padding:8px;border-radius:6px}
.server{padding:6px;border:1px solid var(--border);margin-bottom:6px;border-radius:4px;cursor:pointer}
.server:hover{background:#333}
</style>
</head>
<body>
<header>ðŸŽ¨ Online Collaborative Draw</header>
<aside>
<h3>Tools</h3>
<button id="pen" class="active">Pen</button>
<button id="eraser">Eraser</button>
<h3>Brush</h3>
<input type="range" id="size" min="1" max="80" value="6">
<input type="range" id="opacity" min="1" max="100" value="100">
<h3>Colors</h3>
<div id="colors" class="row"></div>
<h3>History</h3>
<button id="undo">Undo</button>
<button id="redo">Redo</button>
<h3>Online</h3>
<button id="onlineBtn">Online Mode</button>
<div id="onlinePanel">
<button id="refreshServers">Refresh Servers</button>
<div id="serverList"></div>
<h3>Create Server</h3>
<input id="serverName" placeholder="Server name">
<input id="serverCode" placeholder="Join code (optional)">
<select id="serverPublic"><option value="true">Public</option><option value="false">Private</option></select>
<input id="serverMax" type="number" min="1" max="32" value="8">
<button id="createServer">Create Server</button>
</div>
</aside>
<main><canvas id="canvas" width="1200" height="800"></canvas></main>
<script>
// ================= BASIC DRAW =================
const canvas=document.getElementById('canvas');
const ctx=canvas.getContext('2d');
let drawing=false,tool='pen',color='#000';
const size=document.getElementById('size');
const opacity=document.getElementById('opacity');
const history=[],redoStack=[];
function save(){history.push(canvas.toDataURL());if(history.length>50)history.shift();redoStack.length=0}
function undo(){if(!history.length)return;redoStack.push(canvas.toDataURL());load(history.pop())}
function redo(){if(!redoStack.length)return;history.push(canvas.toDataURL());load(redoStack.pop())}
function load(src){const i=new Image();i.onload=()=>{ctx.clearRect(0,0,canvas.width,canvas.height);ctx.drawImage(i,0,0)};i.src=src}
document.getElementById('undo').onclick=undo;document.getElementById('redo').onclick=redo;
canvas.onmousedown=e=>{drawing=true;save();ctx.beginPath();const r=canvas.getBoundingClientRect();ctx.moveTo(e.clientX-r.left,e.clientY-r.top)};
canvas.onmouseup=()=>drawing=false;canvas.onmouseleave=()=>drawing=false;
canvas.onmousemove=e=>{if(!drawing)return;const r=canvas.getBoundingClientRect();const x=e.clientX-r.left,y=e.clientY-r.top;ctx.lineWidth=size.value;ctx.globalAlpha=opacity.value/100;ctx.lineCap='round';if(tool==='eraser'){ctx.globalCompositeOperation='destination-out'}else{ctx.globalCompositeOperation='source-over';ctx.strokeStyle=color}ctx.lineTo(x,y);ctx.stroke();ctx.beginPath();ctx.moveTo(x,y);if(socket&&socket.readyState===1)sendDraw(x,y)};
document.getElementById('pen').onclick=()=>tool='pen';document.getElementById('eraser').onclick=()=>tool='eraser';
const palette=['#000','#fff','#f00','#0f0','#00f','#ff0','#0ff','#f0f','#800','#080','#008','#fa0','#0af','#a0f','#f55','#5f5','#55f'];
const colors=document.getElementById('colors');palette.forEach(c=>{const d=document.createElement('div');d.className='swatch';d.style.background=c;d.onclick=()=>{color=c;document.querySelectorAll('.swatch').forEach(s=>s.classList.remove('active'));d.classList.add('active')};colors.appendChild(d)});
// ================= ONLINE MODE =================
let socket=null;const onlineBtn=document.getElementById('onlineBtn');const panel=document.getElementById('onlinePanel');
onlineBtn.onclick=()=>panel.style.display=panel.style.display==='none'?'block':'none';
function connect(serverId,code){socket=new WebSocket('wss://YOUR_SERVER_URL');socket.onopen=()=>{socket.send(JSON.stringify({type:'join',serverId,code}))};socket.onmessage=e=>{const msg=JSON.parse(e.data);if(msg.type==='draw'){remoteDraw(msg)}}}
function sendDraw(x,y){socket.send(JSON.stringify({type:'draw',x,y,color,size:size.value,opacity:opacity.value,tool}))}
function remoteDraw(d){ctx.lineWidth=d.size;ctx.globalAlpha=d.opacity/100;ctx.lineCap='round';if(d.tool==='eraser'){ctx.globalCompositeOperation='destination-out'}else{ctx.globalCompositeOperation='source-over';ctx.strokeStyle=d.color}ctx.lineTo(d.x,d.y);ctx.stroke();ctx.beginPath();ctx.moveTo(d.x,d.y)}
// ================= SERVER LIST UI =================
const serverList=document.getElementById('serverList');
document.getElementById('refreshServers').onclick=()=>{
fetch('/servers').then(r=>r.json()).then(list=>{serverList.innerHTML='';list.forEach(s=>{const d=document.createElement('div');d.className='server';d.textContent=s.name+' ('+s.players+'/'+s.max+')';d.onclick=()=>connect(s.id,prompt('Enter code if required'));serverList.appendChild(d)})})};
document.getElementById('createServer').onclick=()=>{
fetch('/create',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({name:serverName.value,code:serverCode.value,public:serverPublic.value==='true',max:+serverMax.value})})};
</script>
</body>
</html>